{"version":3,"sources":["wxCloudClientSDK.cjs.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar WxCloudSDKError = /** @class */ (function (_super) {\n    __extends(WxCloudSDKError, _super);\n    function WxCloudSDKError(message, extra) {\n        var _this = _super.call(this, message) || this;\n        _this.name = 'WxCloudSDKError';\n        _this.code = extra === null || extra === void 0 ? void 0 : extra.code;\n        _this.requestId = extra === null || extra === void 0 ? void 0 : extra.requestId;\n        _this.originError = extra === null || extra === void 0 ? void 0 : extra.originError;\n        return _this;\n    }\n    return WxCloudSDKError;\n}(Error));\n\n/**\n * 获取全局对象 window\n *  小程序中可用, 但小程序中对象信息残缺, 无法访问 navigator 对象, ua 信息也无意义\n */\nfunction getGlobalObj() {\n    // @ts-ignore\n    return (typeof window !== 'undefined' && window) || (typeof globalThis !== 'undefined' && globalThis);\n}\n/** 获取referrer 信息, 担心小程序中报错, 故catch */\nfunction getReferrer() {\n    try {\n        var globalObj = getGlobalObj();\n        if (!globalObj)\n            return;\n        // 浏览器中\n        // @ts-ignore\n        if (typeof wx === 'undefined') {\n            // @ts-ignore\n            return getGlobalObj().location.href;\n        }\n        // 当前页面路由\n        // @ts-ignore\n        return globalObj.__wxRoute;\n    }\n    catch (_a) { }\n}\n/** 获取用户UA, 小程序中使用 getSystemInfo 替代 */\nfunction getUserAgent() {\n    var globalObj = getGlobalObj();\n    // @ts-ignore\n    if (globalObj === null || globalObj === void 0 ? void 0 : globalObj.navigator)\n        return globalObj.navigator.userAgent;\n    // 微信小程序\n    // @ts-ignore\n    if (typeof wx !== 'undefined' && wx.getSystemInfo) {\n        var ua_1;\n        // 同步接口\n        // @ts-ignore\n        wx.getSystemInfo({\n            success: function (res) {\n                if (!res)\n                    return;\n                ua_1 = ['brand', 'model', 'version', 'system', 'platform', 'SDKVersion', 'language']\n                    .map(function (k) { return \"\".concat(k, \": \").concat(res[k]); })\n                    .join(', ');\n            }\n        });\n        return ua_1;\n    }\n}\nvar VERSION = \"1.6.1\";\n\nvar callDataSource = function (_a) {\n    var dataSourceName = _a.dataSourceName, methodName = _a.methodName, params = _a.params, realMethodName = _a.realMethodName, callFunction = _a.callFunction, _b = _a.envType, envType = _b === void 0 ? 'prod' : _b, mode = _a.mode;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var result, response, requestId, error_1;\n        var _c, _d;\n        return __generator(this, function (_e) {\n            switch (_e.label) {\n                case 0:\n                    result = {\n                        data: {},\n                        requestId: ''\n                    };\n                    _e.label = 1;\n                case 1:\n                    _e.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, callFunction({\n                            name: 'lowcode-datasource',\n                            data: {\n                                dataSourceName: dataSourceName,\n                                methodName: methodName,\n                                params: params,\n                                userAgent: getUserAgent(),\n                                referrer: getReferrer(),\n                                'x-sdk-version': VERSION,\n                                /**\n                                 * todo 移除此字段\n                                 */\n                                envType: envType,\n                                mode: mode\n                            }\n                        })];\n                case 2:\n                    response = _e.sent();\n                    requestId = ((_c = response === null || response === void 0 ? void 0 : response.result) === null || _c === void 0 ? void 0 : _c.requestId) || (response === null || response === void 0 ? void 0 : response.requestId) || (response === null || response === void 0 ? void 0 : response.requestID);\n                    if (response === null || response === void 0 ? void 0 : response.result.code) {\n                        throw new WxCloudSDKError(\"\\u3010\\u9519\\u8BEF\\u3011\".concat(response === null || response === void 0 ? void 0 : response.result.message, \"\\n\\u3010\\u64CD\\u4F5C\\u3011\\u8C03\\u7528 models.\").concat(dataSourceName ? \"\".concat(dataSourceName, \".\") : \"\").concat(realMethodName, \"\\n\\u3010\\u9519\\u8BEF\\u7801\\u3011\").concat(response === null || response === void 0 ? void 0 : response.result.code, \"\\n\\u3010\\u8BF7\\u6C42ID\\u3011\").concat(requestId || 'N/A'), {\n                            code: response === null || response === void 0 ? void 0 : response.result.code,\n                            requestId: requestId\n                        });\n                    }\n                    else {\n                        result.data = ((_d = response === null || response === void 0 ? void 0 : response.result) === null || _d === void 0 ? void 0 : _d.data) || {};\n                        result.requestId = requestId;\n                    }\n                    return [3 /*break*/, 4];\n                case 3:\n                    error_1 = _e.sent();\n                    if (error_1.name === 'WxCloudSDKError') {\n                        throw error_1;\n                    }\n                    else {\n                        console.log(error_1);\n                        throw new WxCloudSDKError(\"\\u3010\\u9519\\u8BEF\\u3011\".concat(error_1.message, \"\\n      \\u3010\\u64CD\\u4F5C\\u3011\\u8C03\\u7528 models.\").concat(dataSourceName ? \"\".concat(dataSourceName, \".\") : \"\").concat(realMethodName, \"\\n      \\u3010\\u8BF7\\u6C42ID\\u3011N/A\"), {\n                            code: 'UnknownError',\n                            originError: error_1\n                        });\n                    }\n                case 4: return [2 /*return*/, result];\n            }\n        });\n    });\n};\nvar runMysqlCommand = function (_a) {\n    var sql = _a.sql, params = _a.params, config = _a.config, callFunction = _a.callFunction, _b = _a.unsafe, unsafe = _b === void 0 ? false : _b;\n    return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_c) {\n            return [2 /*return*/, callDataSource({\n                    realMethodName: '$runSQL',\n                    methodName: 'callWedaApi',\n                    params: {\n                        action: 'RunMysqlCommand',\n                        data: {\n                            sqlTemplate: sql,\n                            config: config,\n                            parameter: unsafe\n                                ? ''\n                                : Object.entries(params || {}).reduce(function (list, _a) {\n                                    var key = _a[0], value = _a[1];\n                                    if (value !== undefined) {\n                                        var type = \"OBJECT\" /* EQUERY_PARAM_TYPE.OBJECT */;\n                                        var typeofValue = typeof value;\n                                        switch (typeofValue) {\n                                            case 'boolean': {\n                                                type = \"BOOLEAN\" /* EQUERY_PARAM_TYPE.BOOLEAN */;\n                                                break;\n                                            }\n                                            case 'number': {\n                                                type = \"NUMBER\" /* EQUERY_PARAM_TYPE.NUMBER */;\n                                                break;\n                                            }\n                                            case 'string': {\n                                                type = \"STRING\" /* EQUERY_PARAM_TYPE.STRING */;\n                                                break;\n                                            }\n                                            default: {\n                                                if (Array.isArray(value)) {\n                                                    type = \"ARRAY\" /* EQUERY_PARAM_TYPE.ARRAY */;\n                                                }\n                                                else {\n                                                    type = \"OBJECT\" /* EQUERY_PARAM_TYPE.OBJECT */;\n                                                }\n                                            }\n                                        }\n                                        list.push({\n                                            key: key,\n                                            type: type,\n                                            value: type === \"STRING\" /* EQUERY_PARAM_TYPE.STRING */ ? value : JSON.stringify(value)\n                                        });\n                                    }\n                                    return list;\n                                }, []) || []\n                        }\n                    },\n                    callFunction: callFunction,\n                    mode: 'sdk'\n                })];\n        });\n    });\n};\n\nvar createRawQueryClient = function (callFunction) { return ({\n    $runSQL: function (sql, params, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, runMysqlCommand({\n                            sql: sql,\n                            params: params,\n                            config: __assign(__assign({}, config), { preparedStatements: true }),\n                            callFunction: callFunction\n                        })];\n                    case 1:\n                        res = _a.sent();\n                        return [2 /*return*/, res];\n                }\n            });\n        });\n    },\n    $runSQLRaw: function (sql, config) {\n        return __awaiter(this, void 0, void 0, function () {\n            var res;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, runMysqlCommand({\n                            sql: sql,\n                            params: [],\n                            config: __assign(__assign({}, config), { preparedStatements: false }),\n                            callFunction: callFunction\n                        })];\n                    case 1:\n                        res = _a.sent();\n                        return [2 /*return*/, res];\n                }\n            });\n        });\n    }\n}); };\n\nvar READ_DEFAULT_PARAMS = {\n    filter: {\n        where: {}\n    },\n    select: {\n        $master: true\n    }\n};\nfunction createDefaultMethod(methodName) {\n    return {\n        getUrl: function (modelName) { return \"\".concat(modelName, \"/\").concat(methodName); },\n        method: 'post'\n    };\n}\nvar HTTP_DATA_MODEL_METHODS = {\n    get: __assign(__assign({}, createDefaultMethod('get')), { defaultParams: __assign({}, READ_DEFAULT_PARAMS) }),\n    list: __assign(__assign({}, createDefaultMethod('list')), { defaultParams: __assign({}, READ_DEFAULT_PARAMS) }),\n    create: createDefaultMethod('create'),\n    createMany: createDefaultMethod('createMany'),\n    update: __assign(__assign({}, createDefaultMethod('update')), { method: 'put' }),\n    updateMany: __assign(__assign({}, createDefaultMethod('updateMany')), { method: 'put' }),\n    upsert: createDefaultMethod('upsert'),\n    \"delete\": createDefaultMethod('delete'),\n    deleteMany: createDefaultMethod('deleteMany')\n};\nvar UNKNOWN_ERROR_MESSAGE = 'Unknown error occurred';\nvar NOT_SUPPORTED_CODE = 'NotSupported';\nvar generateHTTPClient = function (callFunction, fetch, baseUrl, options) {\n    var rawQueryClient = createRawQueryClient(callFunction);\n    return new Proxy({}, {\n        get: function (_, modelName) {\n            if (typeof modelName !== 'string')\n                return undefined;\n            if (Object.prototype.hasOwnProperty.call(rawQueryClient, modelName)) {\n                return rawQueryClient[modelName];\n            }\n            return generateHTTPClientByDataSourceName(baseUrl, modelName, fetch, options);\n        }\n    });\n};\nvar createWxCloudSDKError = function (message, modelName, methodName, code, requestId) {\n    return new WxCloudSDKError(\"\\u3010\\u9519\\u8BEF\\u3011\".concat(message, \"\\n\\u3010\\u64CD\\u4F5C\\u3011\\u8C03\\u7528 models.\").concat(modelName, \".\").concat(methodName, \"\\n\\u3010\\u9519\\u8BEF\\u7801\\u3011\").concat(code, \"\\n\\u3010\\u8BF7\\u6C42ID\\u3011\").concat(requestId), {\n        code: code,\n        requestId: requestId\n    });\n};\nvar generateHTTPClientByDataSourceName = function (baseUrl, modelName, fetch, options) {\n    var client = new Proxy({}, {\n        get: function (_, methodName) {\n            if (methodName !== 'runSQLTemplate') {\n                var httpDataModelMethod_1 = HTTP_DATA_MODEL_METHODS[methodName];\n                if (!httpDataModelMethod_1) {\n                    var error = new Error(\"\\u4E0D\\u652F\\u6301\\u7684\\u64CD\\u4F5C: \".concat(methodName));\n                    throw new WxCloudSDKError(error.message || UNKNOWN_ERROR_MESSAGE, {\n                        originError: error,\n                        code: NOT_SUPPORTED_CODE,\n                        requestId: 'N/A'\n                    });\n                }\n                return function (params) {\n                    if (params === void 0) { params = {}; }\n                    return __awaiter(void 0, void 0, void 0, function () {\n                        var getUrl, method, _a, defaultParams, effectiveParams, envType, url, result, error_1;\n                        var _b;\n                        return __generator(this, function (_c) {\n                            switch (_c.label) {\n                                case 0:\n                                    getUrl = httpDataModelMethod_1.getUrl, method = httpDataModelMethod_1.method, _a = httpDataModelMethod_1.defaultParams, defaultParams = _a === void 0 ? {} : _a;\n                                    effectiveParams = Object.assign({}, defaultParams, params);\n                                    envType = effectiveParams.envType === 'pre' ? 'pre' : 'prod';\n                                    url = [baseUrl, envType, getUrl(modelName)].join('/');\n                                    _c.label = 1;\n                                case 1:\n                                    _c.trys.push([1, 3, , 4]);\n                                    return [4 /*yield*/, fetch({\n                                            url: url,\n                                            body: JSON.stringify(effectiveParams),\n                                            method: method\n                                        })];\n                                case 2:\n                                    result = _c.sent();\n                                    if (result.code) {\n                                        // 抛出错误\n                                        throw createWxCloudSDKError(result === null || result === void 0 ? void 0 : result.message, modelName, methodName, result === null || result === void 0 ? void 0 : result.code, result === null || result === void 0 ? void 0 : result.requestId);\n                                    }\n                                    if (methodName === 'get') {\n                                        // 和 callFunction 实现保持一致\n                                        Object.assign(result, { data: (_b = result.data.record) !== null && _b !== void 0 ? _b : result.data });\n                                    }\n                                    return [2 /*return*/, result];\n                                case 3:\n                                    error_1 = _c.sent();\n                                    throw new WxCloudSDKError((error_1 === null || error_1 === void 0 ? void 0 : error_1.message) || UNKNOWN_ERROR_MESSAGE, {\n                                        originError: error_1\n                                    });\n                                case 4: return [2 /*return*/];\n                            }\n                        });\n                    });\n                };\n            }\n            else {\n                if (!(options === null || options === void 0 ? void 0 : options.sqlBaseUrl)) {\n                    var error = new Error(\"\\u4E0D\\u652F\\u6301\\u7684\\u64CD\\u4F5C: \".concat(methodName));\n                    throw new WxCloudSDKError(error.message || UNKNOWN_ERROR_MESSAGE, {\n                        originError: error,\n                        code: NOT_SUPPORTED_CODE,\n                        requestId: 'N/A'\n                    });\n                }\n                return function (props) { return __awaiter(void 0, void 0, void 0, function () {\n                    var params, templateName, _envType, envType, url, parameter, result, error_2;\n                    var _a, _b, _c, _d, _e, _f, _g, _h;\n                    return __generator(this, function (_j) {\n                        switch (_j.label) {\n                            case 0:\n                                params = props.params, templateName = props.templateName, _envType = props.envType;\n                                envType = _envType === 'pre' ? 'pre' : 'prod';\n                                url = [options.sqlBaseUrl, envType, templateName, 'run'].join('/');\n                                parameter = Object.entries(params || {}).reduce(function (list, _a) {\n                                    var key = _a[0], value = _a[1];\n                                    if (value !== undefined) {\n                                        var type = \"OBJECT\" /* EQUERY_PARAM_TYPE.OBJECT */;\n                                        var typeofValue = typeof value;\n                                        switch (typeofValue) {\n                                            case 'boolean': {\n                                                type = \"BOOLEAN\" /* EQUERY_PARAM_TYPE.BOOLEAN */;\n                                                break;\n                                            }\n                                            case 'number': {\n                                                type = \"NUMBER\" /* EQUERY_PARAM_TYPE.NUMBER */;\n                                                break;\n                                            }\n                                            case 'string': {\n                                                type = \"STRING\" /* EQUERY_PARAM_TYPE.STRING */;\n                                                break;\n                                            }\n                                            default: {\n                                                if (Array.isArray(value)) {\n                                                    type = \"ARRAY\" /* EQUERY_PARAM_TYPE.ARRAY */;\n                                                }\n                                                else {\n                                                    type = \"OBJECT\" /* EQUERY_PARAM_TYPE.OBJECT */;\n                                                }\n                                            }\n                                        }\n                                        list.push({\n                                            key: key,\n                                            type: type,\n                                            value: type === \"STRING\" /* EQUERY_PARAM_TYPE.STRING */ ? value : JSON.stringify(value)\n                                        });\n                                    }\n                                    return list;\n                                }, []);\n                                _j.label = 1;\n                            case 1:\n                                _j.trys.push([1, 3, , 4]);\n                                return [4 /*yield*/, fetch({\n                                        url: url,\n                                        body: JSON.stringify({ parameter: parameter }),\n                                        method: 'POST'\n                                    })];\n                            case 2:\n                                result = _j.sent();\n                                if ((_a = result === null || result === void 0 ? void 0 : result.Response) === null || _a === void 0 ? void 0 : _a.Error) {\n                                    // 抛出错误\n                                    throw createWxCloudSDKError((_c = (_b = result === null || result === void 0 ? void 0 : result.Response) === null || _b === void 0 ? void 0 : _b.Error) === null || _c === void 0 ? void 0 : _c.Message, modelName, methodName, (_e = (_d = result === null || result === void 0 ? void 0 : result.Response) === null || _d === void 0 ? void 0 : _d.Error) === null || _e === void 0 ? void 0 : _e.Code, (_f = result === null || result === void 0 ? void 0 : result.Response) === null || _f === void 0 ? void 0 : _f.RequestId);\n                                }\n                                return [2 /*return*/, __assign(__assign({}, ((_g = result === null || result === void 0 ? void 0 : result.Response) !== null && _g !== void 0 ? _g : {})), { data: (_h = result === null || result === void 0 ? void 0 : result.Response) === null || _h === void 0 ? void 0 : _h.Data })];\n                            case 3:\n                                error_2 = _j.sent();\n                                throw new WxCloudSDKError((error_2 === null || error_2 === void 0 ? void 0 : error_2.message) || UNKNOWN_ERROR_MESSAGE, {\n                                    originError: error_2\n                                });\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); };\n            }\n        }\n    });\n    return client;\n};\n\nvar CRUD_METHODS = {\n    create: {\n        methodName: 'wedaCreateV2'\n    },\n    createMany: {\n        methodName: 'wedaBatchCreateV2'\n    },\n    update: {\n        methodName: 'wedaUpdateV2'\n    },\n    upsert: {\n        methodName: 'wedaUpsertV2'\n    },\n    updateMany: {\n        methodName: 'wedaBatchUpdateV2'\n    },\n    \"delete\": {\n        methodName: 'wedaDeleteV2'\n    },\n    deleteMany: {\n        methodName: 'wedaBatchDeleteV2'\n    },\n    get: {\n        methodName: 'wedaGetItemV2',\n        defaultParams: {\n            filter: {\n                where: {}\n            },\n            select: {\n                $master: true\n            }\n        }\n    },\n    list: {\n        methodName: 'wedaGetRecordsV2',\n        defaultParams: {\n            filter: {\n                where: {}\n            },\n            select: {\n                $master: true\n            }\n        }\n    }\n};\nvar generateClientByDataSourceName = function (dataSourceName, callFunction) {\n    var client = new Proxy({}, {\n        get: function (target, methodName) {\n            var operation = CRUD_METHODS[methodName];\n            if (!operation) {\n                var error = new Error(\"\\u4E0D\\u652F\\u6301\\u7684\\u64CD\\u4F5C: \".concat(methodName));\n                throw new WxCloudSDKError(error.message || 'Unknown error occurred', {\n                    originError: error,\n                    code: 'NotSupported',\n                    requestId: 'N/A'\n                });\n            }\n            return function (params) { return __awaiter(void 0, void 0, void 0, function () {\n                var effectiveParams, rawData, result, dataKey;\n                var _a;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            effectiveParams = __assign(__assign({}, (operation.defaultParams || {})), (params || {}));\n                            return [4 /*yield*/, callDataSource({\n                                    callFunction: callFunction,\n                                    dataSourceName: dataSourceName,\n                                    methodName: operation.methodName,\n                                    realMethodName: methodName,\n                                    params: effectiveParams,\n                                    envType: params === null || params === void 0 ? void 0 : params.envType\n                                })];\n                        case 1:\n                            rawData = _b.sent();\n                            result = { data: {} };\n                            dataKey = operation.responseKey;\n                            result.data = dataKey ? (_a = rawData === null || rawData === void 0 ? void 0 : rawData.data) === null || _a === void 0 ? void 0 : _a[dataKey] : rawData === null || rawData === void 0 ? void 0 : rawData.data;\n                            return [2 /*return*/, result];\n                    }\n                });\n            }); };\n        }\n    });\n    return client;\n};\n// 使用 TypeScript 的 Proxy 来定义一个动态的客户端\nvar generateClient = function (callFunction) {\n    var rawQueryClient = createRawQueryClient(callFunction);\n    return new Proxy({}, {\n        get: function (target, prop) {\n            if (typeof prop === 'string') {\n                if (Object.prototype.hasOwnProperty.call(rawQueryClient, prop)) {\n                    return rawQueryClient[prop];\n                }\n                // 返回一个函数，这个函数接受任意参数并返回一个 Promise\n                return generateClientByDataSourceName(prop, callFunction);\n            }\n        }\n    });\n};\n\nfunction initHTTPOverCallFunction(cloud, options) {\n    var _this = this;\n    if (!cloud) {\n        throw new Error('cloud is required');\n    }\n    if (!cloud.callFunction) {\n        throw new Error('cloud.callFunction is required');\n    }\n    var callFunction = cloud.callFunction.bind(cloud);\n    var ormClient;\n    try {\n        var HTTPOverCallFunctionFetch = function (_a) {\n            var url = _a.url, body = _a.body, method = _a.method, headers = _a.headers;\n            return __awaiter(_this, void 0, void 0, function () {\n                var res, result;\n                var _b;\n                return __generator(this, function (_c) {\n                    switch (_c.label) {\n                        case 0: return [4 /*yield*/, callFunction({\n                                name: 'httpOverCallFunction',\n                                data: {\n                                    url: url,\n                                    method: method === null || method === void 0 ? void 0 : method.toUpperCase(),\n                                    headers: __assign(__assign({}, (headers || {})), { 'Content-Type': 'application/json' }),\n                                    body: body\n                                }\n                            })];\n                        case 1:\n                            res = _c.sent();\n                            result = (_b = res === null || res === void 0 ? void 0 : res.result) === null || _b === void 0 ? void 0 : _b.body;\n                            return [2 /*return*/, result];\n                    }\n                });\n            });\n        };\n        var baseUrl = (options === null || options === void 0 ? void 0 : options.baseUrl) || getDefaultGatewayBaseUrl(cloud).model;\n        var sqlBaseUrl = (options === null || options === void 0 ? void 0 : options.sqlBaseUrl) || getDefaultGatewayBaseUrl(cloud).sql;\n        ormClient = generateHTTPClient(callFunction, HTTPOverCallFunctionFetch, baseUrl, {\n            sqlBaseUrl: sqlBaseUrl\n        });\n    }\n    catch (e) {\n        console.error('init http orm client failed, try call function orm', e);\n        ormClient = generateClient(callFunction);\n    }\n    cloud.models = ormClient;\n    return cloud;\n}\nfunction init(cloud) {\n    if (!cloud) {\n        throw new Error('cloud is required');\n    }\n    if (!cloud.callFunction) {\n        throw new Error('cloud.callFunction is required');\n    }\n    var ormClientImpl = generateClient(cloud.callFunction.bind(cloud));\n    cloud.models = ormClientImpl;\n    return cloud;\n}\nfunction getDefaultGatewayBaseUrl(cloud) {\n    var _a, _b, _c, _d;\n    var env = (_b = (_a = cloud === null || cloud === void 0 ? void 0 : cloud.extend) === null || _a === void 0 ? void 0 : _a.AI) === null || _b === void 0 ? void 0 : _b.env;\n    if (typeof env !== 'string' || !env.trim())\n        env = (_c = cloud === null || cloud === void 0 ? void 0 : cloud.config) === null || _c === void 0 ? void 0 : _c.env;\n    if (typeof env !== 'string' || !env.trim())\n        env = (_d = cloud === null || cloud === void 0 ? void 0 : cloud.config) === null || _d === void 0 ? void 0 : _d.envName;\n    if (typeof env !== 'string' || !env.trim()) {\n        throw new Error('Generating default gateway base url failed: env not found');\n    }\n    env = env.trim();\n    return {\n        model: \"https://\".concat(env, \".api.tcloudbasegateway.com/v1/model\"),\n        sql: \"https://\".concat(env, \".api.tcloudbasegateway.com/v1/sql\")\n    };\n}\nvar index = {\n    init: init,\n    generateHTTPClient: generateHTTPClient\n};\n\nexports.default = index;\nexports.generateHTTPClient = generateHTTPClient;\nexports.init = init;\nexports.initHTTPOverCallFunction = initHTTPOverCallFunction;\n"]}