/**
 * AgoraWebSDK_N-v4.23.2-1-0-g7fdaa39d-dirty Copyright AgoraInc.
 */

import e from"ua-parser-js";import t from"axios";const r=()=>{};function s(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:r};return e.promise=new Promise(((t,r)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(t))}})),e}function i(e){const t=s();return t.resolve(e),t}function n(e){const t=s(),r=setTimeout(t.resolve,e);return t.cancel=()=>clearTimeout(r),t}const o=new Map,a=new Map,c=new Map;function d(e,t){a.set(e,t)}async function u(e,t,r){o.get(e)||o.set(e,[]),a.get(e)||a.set(e,t),c.get(e)||c.set(e,0);const i=o.get(e),n=a.get(e);if(!i||!n)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(c.get(e)===n){const e=s();i.push(e),await e.promise}c.set(e,c.get(e)+1);for(var d=arguments.length,u=new Array(d>3?d-3:0),E=3;E<d;E++)u[E-3]=arguments[E];const _=await r(...u);return c.set(e,c.get(e)-1),c.get(e)===n-1&&i.length>0&&(i[0].resolve(),i.shift()),0===c.get(e)&&(o.set(e,[]),a.set(e,0),c.set(e,0)),_}let E=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),_=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const h=new e;let l=h.getResult(),p=null;function T(e){if(!p){e&&h.setUA(e),l=h.getResult();const t=R(l),r=m(l),s=A(l),i=l.os.version,n=m(l,!1),o=l.device.type;if(!(t&&r&&s&&i))return{name:t,version:r,os:s,osVersion:i,browserVersion:n,deviceType:o};p={name:t,version:r,os:s,osVersion:i,browserVersion:n,deviceType:o}}return p}function R(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return _.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return _.CHROME;case"Safari":case"Mobile Safari":return _.SAFARI;case"Edge":return _.EDGE;case"Firefox":return _.FIREFOX;case"QQ":case"QQBrowser":return _.QQ;case"Opera":return _.OPERA;case"WeChat":return _.WECHAT;default:return e.browser.name||""}}function m(e){let t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function A(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}function I(e){const t=e||navigator.userAgent;let r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===r[1]){const e=t.match(/(OPR(?=\/))\/?(\d+)/i);null!==e&&(r=e)}if("Safari"===r[1]){const e=t.match(/version\/(\d+)/i);null!==e&&(r[2]=e[1])}if(-1!==t.toLowerCase().indexOf("qqbrowser")){const e=t.match(/(qqbrowser(?=\/))\/?(\d+)/i);null!==e&&(r=e)}if(-1!==t.toLowerCase().indexOf("micromessenger")){const e=t.match(/(micromessenger(?=\/))\/?(\d+)/i);null!==e&&(r=e)}if(-1!==t.toLowerCase().indexOf("edge")){const e=t.match(/(edge(?=\/))\/?(\d+)/i);null!==e&&(r=e)}if(-1!==t.toLowerCase().indexOf("trident")){const e=/\brv[ :]+(\d+)/g.exec(t)||[];null!==e&&(r=["","IE",e[1]])}let s=null;const i=[{s:E.WIN_10,r:/(Windows 10.0|Windows NT 10.0)/},{s:E.WIN_81,r:/(Windows 8.1|Windows NT 6.3)/},{s:E.WIN_8,r:/(Windows 8|Windows NT 6.2)/},{s:E.WIN_7,r:/(Windows 7|Windows NT 6.1)/},{s:E.WIN_VISTA,r:/Windows NT 6.0/},{s:E.WIN_SERVER_2003,r:/Windows NT 5.2/},{s:E.WIN_XP,r:/(Windows NT 5.1|Windows XP)/},{s:E.WIN_2000,r:/(Windows NT 5.0|Windows 2000)/},{s:E.ANDROID,r:/Android/},{s:E.OPEN_BSD,r:/OpenBSD/},{s:E.SUN_OS,r:/SunOS/},{s:E.LINUX,r:/(Linux|X11)/},{s:E.IOS,r:/(iPhone|iPad|iPod)/},{s:E.MAC_OS,r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:E.QNX,r:/QNX/},{s:E.UNIX,r:/UNIX/},{s:E.BEOS,r:/BeOS/},{s:E.OS_2,r:/OS\/2/},{s:E.SEARCH_BOT,r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(const e of i)if(e.r.test(t)){s=e.s;break}return{name:r[1],version:r[2],os:s}}function S(){return T().version}function O(){return T().os}function N(){const e=T();return"".concat(e.os," ").concat(e.osVersion)}function C(){const e=T();return!!("WebKit"===l.engine.name&&e.os===E.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==_.SAFARI||w()&&e.name!==_.SAFARI)}function f(){const e=T();if(C()){if(e.os===E.MAC_OS)return!0;if(e.os===E.IOS){const e=l.os.version&&l.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}function D(){return"WebKit"===l.engine.name}function g(){return T().name===_.CHROME}function L(){return T().name===_.SAFARI}function b(){const e=T();if(e.name!==_.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||15===Number(t[0])&&Number(t[1])>=4}function M(){return T().name===_.EDGE}function y(){return T().name===_.FIREFOX}function P(){return T().name===_.OPERA}function v(){return T().name===_.QQ}function w(){return T().os===E.IOS}function U(e){const t=T();return!(t.name!==_.CHROME||!t.osVersion)&&Number(t.version)>=e}function F(e){const t=T();return!(t.name!==_.CHROME||!t.osVersion)&&Number(t.version)<e}function V(e,t,r){const s=T();return!(s.name!==e||!s.osVersion)&&(r?Number(s.version)>=t&&Number(s.version)<=r:Number(s.version)===t)}function k(e){const t=T();return!(t.name!==_.EDGE||!t.osVersion)&&Number(t.version)>=e}function B(e){const t=T();return!(t.name!==_.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function x(e){const t=T();return!(t.name!==_.SAFARI||!t.osVersion)&&Number(t.version)>=e}function G(e){const t=T();if(t.os!==E.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])>=e}function K(e,t,r){const s=T();if(s.os!==E.IOS||!s.osVersion)return!1;const i=s.osVersion.split(".");return r?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function W(e,t,r){const s=T();if(s.name!==_.SAFARI||!s.osVersion||!s.browserVersion)return!1;const i=s.browserVersion.split(".");return r?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function H(e){const t=T();return!(t.name!==_.OPERA||!t.osVersion)&&Number(t.version)>=e}function Y(){const e=T();return!(e.name!==_.CHROME||!e.osVersion)&&Number(e.version)<=90}function j(){return T().os===E.MAC_OS}function X(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 13===Number(t[0])}function J(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])>=13}function z(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function Q(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function q(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function Z(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])&&Number(t[1])>=0}function $(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&0===Number(t[1])}function ee(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function te(){const e=T();if(e.os!==E.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}function re(){return L()&&navigator.maxTouchPoints>0}function se(){return T().name===_.WECHAT}function ie(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ne(){const e=O();return e===E.LINUX||e===E.MAC_OS||-1!==e.indexOf("Windows")}function oe(){return-1!==O().indexOf("Windows")}function ae(){const{deviceType:e}=T();return"mobile"===e||"tablet"===e}function ce(){const e=O();return ae()||e===E.ANDROID||e===E.IOS||e===E.HARMONY_OS}function de(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?e[0].split("/")[1]:null}function ue(){const e=T();if(e.name===_.EDGE||e.name===_.SAFARI)return!1;return!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ee(){return O()===E.HARMONY_OS}function _e(){return O()===E.ANDROID}function he(){const e=T();return _e()&&(e.name===_.CHROME||e.name===_.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function le(){return!!window.navigator.userAgent.includes("AgoraWebView")}function pe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function Re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){pe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}let me=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class Ae extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),pe(this,"code",void 0),pe(this,"message",void 0),pe(this,"data",void 0),pe(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,"\ndata: ").concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function Ie(e,t){return new Ae(me.UNEXPECTED_ERROR,e,t)}function Se(e,t){if("boolean"!=typeof e)throw new Ae(me.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Oe(e,t,r){if(r.includes(e))return;throw new Ae(me.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function Ne(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<r||e>s||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e)){throw new Ae(me.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(s,"]. integer only"))}}function Ce(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact)){throw new Ae(me.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"))}void 0!==e.min&&Ne(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&Ne(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&Ne(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&Ne(e.ideal,"".concat(t,".ideal"),1,1/0)}else Ne(e,t,1,1/0)}function fe(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Ae(me.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!be(e,r,s,i))throw new Ae(me.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(s,"].").concat(i?" ASCII characters only.":""))}function De(e,t){if(!Array.isArray(e))throw new Ae(me.INVALID_PARAMS,"".concat(t," should be an array"))}function ge(e,t){const r=Object.keys(e).sort(),s=Object.keys(t).sort();for(let i=0;i<r.length;i+=1){if(r[i]!==s[i])return!1;if(e[r[i]]!==t[r[i]])return!1}return!0}function Le(e){return null==e}function be(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=r&&e.length>=t&&(!s||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const r=e.charCodeAt(t);if(r<0||r>255)return!1}return!0}(e))}function Me(e,t,r){if("getBigInt64"in DataView.prototype)return e.getBigInt64(t,r);const s=Number(!!r),i=Number(!r);return BigInt(e.getInt32(t,r)*i+e.getInt32(t+4,r)*s)<<BigInt(32)|BigInt(e.getUint32(t,r)*s+e.getUint32(t+4,r)*i)}function ye(e,t,r){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,r);const s=e.getUint32(t,r),i=e.getUint32(t+4,r),n=Number(!!r),o=Number(!r);return BigInt(s*o+i*n)<<BigInt(32)|BigInt(s*n+i*o)}function Pe(e,t,r,s){if("setBigInt64"in DataView.prototype)return e.setBigInt64(t,r,s);const i=Number(r>>BigInt(32)),n=Number(r&BigInt(4294967295));s?(e.setInt32(t+4,i,s),e.setUint32(t,n,s)):(e.setInt32(t,i,s),e.setUint32(t+4,n,s))}function ve(e,t,r,s){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,r,s);const i=Number(r>>BigInt(32)),n=Number(r&BigInt(4294967295));s?(e.setUint32(t+4,i,s),e.setUint32(t,n,s)):(e.setUint32(t,i,s),e.setUint32(t+4,n,s))}var we=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(we||{}),Ue=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Ue||{});const Fe=new class{constructor(){pe(this,"_clientSize",null),pe(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),pe(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),pe(this,"getStyle",(e=>window.getComputedStyle(e,null))),pe(this,"checkCssVisibleProperty",(e=>{let t=!0;const r=this.getStyle(e),{display:s,visibility:i,opacity:n,filter:o}=r;if(("none"===s||["hidden","collapse"].includes(i)||Number(n)<.1)&&(t=!1),!t)return!1;if(o){o.split(" ").filter((e=>{const t=e.split("(")[0];return["brightness","blur","opacity"].includes(t)})).map((e=>{const[t,r]=e.split(/\(|\)/);return[t,Number(r.match(/^[0-9\.]+/))]})).forEach((e=>{const[r,s]=e;switch(r){case"brightness":(s<.1||s>3)&&(t=!1);break;case"blur":s>3&&(t=!1);break;case"opacity":s<.1&&(t=!1)}}))}return t})),pe(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let r=!0,s=!0;const i=e=>t(e);let n=e;for(;n&&s;){i(n)||(r=!1,s=!1),n=n.parentElement,n||(s=!1)}return r})),pe(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),pe(this,"getSizeAboutClient",(e=>{const{width:t,height:r,left:s,right:i,top:n,bottom:o}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:r,left:s,right:i,top:n,bottom:o,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}})),pe(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)})),pe(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),pe(this,"checkCoverForAPoint",((e,t,r)=>{const s=this.elementFromPoint(e,t);return null!==s&&s!==r})),pe(this,"getPointPositionList",(()=>{const{width:e,height:t,left:r,top:s}=this._clientSize,i=e/6,n=t/6,o=[],a=10**6;for(let e=0;e<5;e++)for(let t=0;t<5;t++){const c=(r*a+(0===e?.1:4===e?(i*e*a-1e5)/a:i*e)*a)/a,d=(s*a+(0===t?.1:4===t?(n*t*a-1e5)/a:n*t)*a)/a;o.push({x:c,y:d})}return[...o]})),pe(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),pe(this,"checkSizeIsVisible",((e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10))),pe(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:r,bottom:s,clientHeight:i,clientWidth:n,clientMin:o}=this._clientSize;let a,c,d,u;if(e<0)a=0;else{if(!(e<n))return!1;a=e}if(t<0)return!1;if(c=t<n?t:n,r<0)d=0;else{if(!(r<i))return!1;d=r}if(s<0)return!1;u=s<i?s:i;const E=c-a,_=u-d;return this.checkSizeIsVisible(E,_,o)})),pe(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),pe(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(we.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(we.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(we.SIZE)}}return this.returnHiddenResult(we.STYLE)}return this.returnHiddenResult(Ue.UNMOUNTED)}return this.returnHiddenResult(Ue.INVALID_HTML_ELEMENT)})),pe(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function Ve(e){return(new TextEncoder).encode(e)}const ke=function(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r};function Be(e,t){let r="";return new Uint8Array(e).forEach((e=>{r+=e.toString(t).padStart(2,"0")})),r}const xe=async e=>{const t=function(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);return r}("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),r=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),s=Ve(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},r,s);return function(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}(new Uint8Array(i))},Ge=async e=>Be(await crypto.subtle.digest("SHA-256",Ve(e)),16);class Ke{constructor(){pe(this,"_events",{}),pe(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const r=this._events[e];-1===this._indexOfListener(r,t)&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const r=this._events[e],s=this._indexOfListener(r,t);-1!==s&&r.splice(s,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];for(let r=0;r<t.length;r+=1){const i=t[r];i.once&&this.off(e,i.listener),i.listener.apply(this,s||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,r)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}}function We(){return!!je()}function He(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(((r,s)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const n=document.createElement("div");n.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const d=document.createElement("button");d.innerHTML="cancel",d.setAttribute("style","width: 85px;"),d.onclick=()=>{document.body.removeChild(_);const e=new Error("NotAllowedError");e.name="NotAllowedError",s(e)};let u=t;const E=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=u,e.onchange=()=>{u=e.checked},E.appendChild(e),E.appendChild(t)}c.appendChild(E),c.appendChild(d),n.appendChild(o),n.appendChild(a),n.appendChild(c);const _=document.createElement("div");_.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_.appendChild(i),_.appendChild(n),document.body.appendChild(_),e.map((e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let s=e.thumbnail;try{const{width:e}=s.getSize();e>1920&&(s=s.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+s.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>"),t.onclick=()=>{document.body.removeChild(_),r({sourceId:e.id,audio:u})},a.appendChild(t)}}))}))}let Ye=null;function je(){if(Ye)return Ye;if(window.electron)return Ye=window.electron;if(!window.require)return null;try{return Ye=window.require("electron"),Ye}catch(e){return null}}let Xe=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Je=function(e){return e.TRACER="tracer",e}({});function ze(e){return Ne(e.timeout,"config.timeout",0,1e5),Ne(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Ne(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Ne(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Qe(e){return Oe(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Oe(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&Oe(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&fe(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&et(e.turnServer),void 0!==e.httpRetryConfig&&ze(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&ze(e.websocketRetryConfig),!0}let qe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ze=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function $e(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function et(e){return fe(e.turnServerURL,"turnServerURL"),fe(e.username,"username"),fe(e.password,"password"),e.udpport&&Ne(e.udpport,"udpport",1,99999,!0),e.forceturn&&Se(e.forceturn,"forceturn"),e.security&&Se(e.security,"security"),e.tcpport&&Ne(e.tcpport,"tcpport",1,99999,!0),!0}function tt(e){return Oe(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),!0}function rt(e){return Oe(e,"role",["audience","host"]),!0}function st(e){return Oe(e,"transport",["default","auto","relay","sd-rtn"]),!0}function it(e){return void 0!==e.level&&Oe(e.level,"level",[1,2,3]),void 0!==e.delay&&Ne(e.delay,"delay",0,3e3,!0),!0}let nt=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),ot=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),at=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),ct=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function dt(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return 0===e.getListeners(t).length?Promise.reject(new Ae(me.UNEXPECTED_ERROR,"can not emit promise")):new Promise(((r,i)=>{e.emit(t,...s,r,i)}))}function ut(e,t){if(0===e.getListeners(t).length)return Promise.resolve();for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return dt(e,t,...s)}function Et(e,t){if(0===e.getListeners(t).length)return null;for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return _t(e,t,...s)}function _t(e,t){let r=null,s=null;for(var i=arguments.length,n=new Array(i>2?i-2:0),o=2;o<i;o++)n[o-2]=arguments[o];if(e.emit(t,...n,(e=>{r=e}),(e=>{s=e})),null!==s)throw s;if(null===r)throw new Ae(me.UNEXPECTED_ERROR,"handler is not sync");return r}const ht=new class extends Ke{set networkState(e){this.emit(ct.NETWORK_STATE_CHANGE,e,this._networkState),e===at.ONLINE?this.emit(ct.ONLINE):e===at.OFFLINE&&(this.onlineWaiter=new Promise((e=>{this.once(ct.ONLINE,(()=>{this.onlineWaiter=void 0,e(at.ONLINE)}))})),this.emit(ct.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===at.ONLINE}constructor(){super(),pe(this,"_moduleName","network-indicator"),pe(this,"_networkState",at.ONLINE),pe(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=at.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=at.OFFLINE}))}};function lt(e,t){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}function pt(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function Tt(e){"undefined"!=typeof Promise?Promise.resolve().then(e):setTimeout(e,0)}function Rt(e){return JSON.parse(JSON.stringify(e))}function mt(e){try{return Rt(e)}catch(t){return e}}function At(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1){const s=e[r];if(e.filter((e=>e===s)).length!==t.filter((e=>e===s)).length)return!1}return!0}function It(e,t){const r=[];return e.forEach(((e,s)=>{t(e)&&r.push(s)})),r}function St(e,t){const r=Object.keys(e),s=[];for(const i of r)e[i]!==t[i]&&s.push(i);return s}const Ot={};function Nt(e,t){Ot[t]||(Ot[t]=!0,e())}function Ct(){return"boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname}function ft(e){const t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)r[e]=t.charCodeAt(e);return r}function Dt(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function gt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;let r=(new TextEncoder).encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){const e=new Uint8Array(t);e.set(r),r=e}return r}function Lt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const s=t.reduce(((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(s));let n=0;return t.forEach((e=>{i.set(e,n),n+=e.length})),i}function bt(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Mt(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?bt(e):e.size})),t+138}function yt(e,t,r){const s=e[t];if(!s||"string"!=typeof s)return[e];e[t]="";const i=bt(JSON.stringify(e));let n=0;const o=[];let a=0;for(let c=0;c<s.length;c++)a+=s.charCodeAt(c)<=127?1:3,a<=r-i||(o[o.length]=Re(Re({},e),{},{[t]:s.substring(n,c)}),n=c,a=s.charCodeAt(c)<=127?1:3);return n!==s.length-1&&(o[o.length]=Re(Re({},e),{},{[t]:s.substring(n)})),o}function Pt(e){const t=new Ae(me.TIMEOUT,"timeout");return new Promise(((r,s)=>{window.setTimeout((()=>s(t)),e)}))}function vt(e,t){return t===1/0?e:Promise.race([e,Pt(t)])}function wt(e){return new Promise((t=>{window.setTimeout(t,e)}))}function Ut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+Ut(e-r.length,"")}function Ft(){return"process-".concat(Ut(8,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(4,""),"-").concat(Ut(12,""))}function Vt(){return Ut(32,"").toUpperCase()}function kt(e){e.getTracks().forEach((e=>{e.stop()}))}const Bt=()=>{};const xt=new class{constructor(){pe(this,"fnMap",new Map)}throttleByKey(e,t,r,s){for(var i=arguments.length,n=new Array(i>4?i-4:0),o=4;o<i;o++)n[o-4]=arguments[o];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==r){i.fn(...i.args),clearTimeout(i.timer);const o=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),r);this.fnMap.set(t,{fn:e,threshold:r,timer:o,args:n,skipFn:s})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,Re(Re({},i),{},{fn:e,args:n,skipFn:s}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),r);this.fnMap.set(t,{fn:e,threshold:r,timer:i,args:n,skipFn:s})}}},Gt=xt.throttleByKey.bind(xt);function Kt(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function Wt(e,t){if(!Kt(e)||!Kt(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const r=[...e];for(let s=0;s<t.length;s++)r[s]=Wt(e[s],t[s]);return r}{const r=Re({},e);for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(Object.prototype.hasOwnProperty.call(e,s)?r[s]=Wt(e[s],t[s]):r[s]=t[s]);return r}}function Ht(e){return e!==document.body&&document.body.contains(e)}function Yt(e,t){let r=[0];if(t&&(r=new Array(t).fill(0)),0===e)return r;let s=0;for(;e>0&&(r[s]=255&e,e>>=8,s++,!t||s!==t););return r}function jt(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Xt(e,t){try{return"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)}catch(e){return!1}}function Jt(e){const t=e.split("_");return t[0]+t.slice(1).map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join("")}function zt(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}function Qt(e){const t="0123456789abcdef";function r(e){let r,s="";for(r=0;r<=3;r++)s+=t.charAt(e>>8*r+4&15)+t.charAt(e>>8*r&15);return s}function s(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e,t,r,i,n,o){return s(function(e,t){return e<<t|e>>>32-t}(s(s(t,e),s(i,o)),n),r)}function n(e,t,r,s,n,o,a){return i(t&r|~t&s,e,t,n,o,a)}function o(e,t,r,s,n,o,a){return i(t&s|r&~s,e,t,n,o,a)}function a(e,t,r,s,n,o,a){return i(t^r^s,e,t,n,o,a)}function c(e,t,r,s,n,o,a){return i(r^(t|~s),e,t,n,o,a)}const d=function(e){let t;const r=1+(e.length+8>>6),s=new Array(16*r);for(t=0;t<16*r;t++)s[t]=0;for(t=0;t<e.length;t++)s[t>>2]|=e.charCodeAt(t)<<t%4*8;return s[t>>2]|=128<<t%4*8,s[16*r-2]=8*e.length,s}(e);let u,E,_,h,l,p=1732584193,T=-271733879,R=-1732584194,m=271733878;for(u=0;u<d.length;u+=16)E=p,_=T,h=R,l=m,p=n(p,T,R,m,d[u+0],7,-680876936),m=n(m,p,T,R,d[u+1],12,-389564586),R=n(R,m,p,T,d[u+2],17,606105819),T=n(T,R,m,p,d[u+3],22,-1044525330),p=n(p,T,R,m,d[u+4],7,-176418897),m=n(m,p,T,R,d[u+5],12,1200080426),R=n(R,m,p,T,d[u+6],17,-1473231341),T=n(T,R,m,p,d[u+7],22,-45705983),p=n(p,T,R,m,d[u+8],7,1770035416),m=n(m,p,T,R,d[u+9],12,-1958414417),R=n(R,m,p,T,d[u+10],17,-42063),T=n(T,R,m,p,d[u+11],22,-1990404162),p=n(p,T,R,m,d[u+12],7,1804603682),m=n(m,p,T,R,d[u+13],12,-40341101),R=n(R,m,p,T,d[u+14],17,-1502002290),T=n(T,R,m,p,d[u+15],22,1236535329),p=o(p,T,R,m,d[u+1],5,-165796510),m=o(m,p,T,R,d[u+6],9,-1069501632),R=o(R,m,p,T,d[u+11],14,643717713),T=o(T,R,m,p,d[u+0],20,-373897302),p=o(p,T,R,m,d[u+5],5,-701558691),m=o(m,p,T,R,d[u+10],9,38016083),R=o(R,m,p,T,d[u+15],14,-660478335),T=o(T,R,m,p,d[u+4],20,-405537848),p=o(p,T,R,m,d[u+9],5,568446438),m=o(m,p,T,R,d[u+14],9,-1019803690),R=o(R,m,p,T,d[u+3],14,-187363961),T=o(T,R,m,p,d[u+8],20,1163531501),p=o(p,T,R,m,d[u+13],5,-1444681467),m=o(m,p,T,R,d[u+2],9,-51403784),R=o(R,m,p,T,d[u+7],14,1735328473),T=o(T,R,m,p,d[u+12],20,-1926607734),p=a(p,T,R,m,d[u+5],4,-378558),m=a(m,p,T,R,d[u+8],11,-2022574463),R=a(R,m,p,T,d[u+11],16,1839030562),T=a(T,R,m,p,d[u+14],23,-35309556),p=a(p,T,R,m,d[u+1],4,-1530992060),m=a(m,p,T,R,d[u+4],11,1272893353),R=a(R,m,p,T,d[u+7],16,-155497632),T=a(T,R,m,p,d[u+10],23,-1094730640),p=a(p,T,R,m,d[u+13],4,681279174),m=a(m,p,T,R,d[u+0],11,-358537222),R=a(R,m,p,T,d[u+3],16,-722521979),T=a(T,R,m,p,d[u+6],23,76029189),p=a(p,T,R,m,d[u+9],4,-640364487),m=a(m,p,T,R,d[u+12],11,-421815835),R=a(R,m,p,T,d[u+15],16,530742520),T=a(T,R,m,p,d[u+2],23,-995338651),p=c(p,T,R,m,d[u+0],6,-198630844),m=c(m,p,T,R,d[u+7],10,1126891415),R=c(R,m,p,T,d[u+14],15,-1416354905),T=c(T,R,m,p,d[u+5],21,-57434055),p=c(p,T,R,m,d[u+12],6,1700485571),m=c(m,p,T,R,d[u+3],10,-1894986606),R=c(R,m,p,T,d[u+10],15,-1051523),T=c(T,R,m,p,d[u+1],21,-2054922799),p=c(p,T,R,m,d[u+8],6,1873313359),m=c(m,p,T,R,d[u+15],10,-30611744),R=c(R,m,p,T,d[u+6],15,-1560198380),T=c(T,R,m,p,d[u+13],21,1309151649),p=c(p,T,R,m,d[u+4],6,-145523070),m=c(m,p,T,R,d[u+11],10,-1120210379),R=c(R,m,p,T,d[u+2],15,718787259),T=c(T,R,m,p,d[u+9],21,-343485551),p=s(p,E),T=s(T,_),R=s(R,h),m=s(m,l);return r(p)+r(T)+r(R)+r(m)}function qt(e){const t=[];for(let r=0;r<e.length;r+=2)t.push(parseInt(e.slice(r,r+2),16));return Uint8Array.from(t)}let Zt=1,$t=console;class er{static setLogger(e){$t=e}constructor(e,t){pe(this,"id",void 0),pe(this,"lockingPromise",Promise.resolve()),pe(this,"locks",0),pe(this,"name",""),pe(this,"lockId",void 0),this.lockId=Zt++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),s="created"===e?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(null!=t?t:"");$t.debug("".concat(r," ").concat(s))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const r=new Promise((r=>{t=()=>{this.locks-=1,this.logger("unlocked",e),r()}})),s=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>r)),s}}function tr(e,t){return function(r,s,i){const n=i.value;if("function"!=typeof n)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const r=this[t];if(!r)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await r.lock("From ".concat(e,".").concat(s));try{for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return await n.apply(this,a)}finally{i()}},i}}const rr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function sr(e,t){const r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function ir(e,t,r,s){const i=Object.assign({},rr,s);let n=i.timeout;const o=async()=>{await function(e){return new Promise((t=>{window.setTimeout(t,e)}))}(n),n*=i.timeoutFactor,n=Math.min(i.maxRetryTimeout,n)};let a=!1;const c=new Promise((async(s,n)=>{t=t||(()=>!1),r=r||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(a)return n(new Ae(me.OPERATION_ABORTED));try{const r=await e();if(!t(r,c))return s(r);if(c+1===i.maxRetryCount)return s(r);await o()}catch(e){if(!r(e,c))return n(e);if(c+1===i.maxRetryCount)return n(e);await o()}}}));return c.cancel=()=>a=!0,c}let nr,or=class{constructor(e){pe(this,"input",[]),pe(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){return 0===this.input.length?0:this.input.reduce(((e,t)=>e+t))/this.input.length}},ar=0,cr=0;function dr(e,r,s,i){return new Promise(((n,o)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),ar+=bt(r.data)):s&&(r.data.size?ar+=r.data.size:r.data instanceof FormData?ar+=Mt(r.data):ar+=bt(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,t.request(r).then((e=>{"string"==typeof e.data?cr+=bt(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?cr+=e.data.byteLength:cr+=bt(JSON.stringify(e.data)),i&&n({data:e.data,headers:e.headers}),n(e.data)})).catch((e=>{t.isCancel(e)?o(new Ae(me.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new Ae(me.NETWORK_TIMEOUT,e.message)):e.response?o(new Ae(me.NETWORK_RESPONSE_ERROR,e.response.status)):o(new Ae(me.NETWORK_ERROR,e.message))}))}))}async function ur(e,t){const r=new Blob([t.data],{type:"buffer"});return await dr(e,Re(Re({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}function Er(){return ar}function _r(){return cr}function hr(){ar=0,cr=0}class lr{constructor(e){pe(this,"_transformStream",void 0),pe(this,"_readable",void 0),pe(this,"_writable",void 0),pe(this,"_reader",void 0),pe(this,"_writer",void 0),this._transformStream=new TransformStream({transform:e}),this._readable=this._transformStream.readable,this._writable=this._transformStream.writable,this._reader=this._readable.getReader(),this._writer=this._writable.getWriter()}get reader(){return this._reader}get writer(){return this._writer}close(){this.writer.releaseLock(),this._writable.close(),this.reader.cancel(),this.reader.releaseLock(),this._readable.cancel()}}function pr(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],r=t[2];return"".concat(e,".").concat(r)}return"4.0.0.999"}const Tr=()=>"HTTPS"===(nr||nr||(nr=(window.location.protocol.split(":")[0]||"").toUpperCase(),nr)),Rr=()=>void 0!==window.isSecureContext;function mr(){return new Promise((e=>{document.body?e():window.addEventListener("load",(()=>e()))}))}function Ar(e){if(Array.isArray(e))return e.map((e=>e));if(!Ir(e))return e;const t={};for(const r in e){const s=e[r];Ir(s)||Array.isArray(s)?t[r]=Ar(s):t[r]=s}return t}function Ir(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class Sr{constructor(e){pe(this,"input",[]),pe(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const Or={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Nr={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Or,remoteCandidate:Or},updateInterval:0},Cr={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},fr={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Dr={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},gr={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};class Lr{constructor(e,t){pe(this,"onFirstVideoReceived",void 0),pe(this,"onFirstVideoDecoded",void 0),pe(this,"onFirstAudioReceived",void 0),pe(this,"onFirstVideoDecodedTimeout",void 0),pe(this,"onFirstAudioDecoded",void 0),pe(this,"onSelectedLocalCandidateChanged",void 0),pe(this,"onSelectedRemoteCandidateChanged",void 0),pe(this,"videoIsReady",!1),pe(this,"videoIsReady2",{}),pe(this,"pc",void 0),pe(this,"options",void 0),pe(this,"intervalTimer",void 0),pe(this,"stats",Ar(Nr)),pe(this,"isFirstVideoReceived",{}),pe(this,"isFirstVideoDecoded",{}),pe(this,"isFirstAudioReceived",{}),pe(this,"isFirstAudioDecoded",{}),pe(this,"isFirstVideoDecodedTimeout",{}),pe(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Promise((e=>{e({local:Re({},Or),remote:Re({},Or)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let s=0,i=0,n=0,o=0;for(const a of r)e[a].forEach(((e,r)=>{if(!this.lossRateWindowStats[t-1][a][r]||!this.lossRateWindowStats[0][a][r])return;const c=this.lossRateWindowStats[t-1][a][r].packets-this.lossRateWindowStats[0][a][r].packets,d=this.lossRateWindowStats[t-1][a][r].packetsLost-this.lossRateWindowStats[0][a][r].packetsLost;"videoSend"===a||"audioSend"===a?(s+=c,n+=d):(i+=c,o+=d),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||d<=0?0:d/(c+d)}));e.sendPacketLossRate=s<=0||n<=0?0:n/(s+n),e.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}}class br extends Lr{constructor(){super(...arguments),pe(this,"_stats",Nr),pe(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Ar(Nr);const r=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(r);const s=t.find((e=>"VideoBwe"===e.type));s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{const t=e.id.includes("send");switch("".concat(e.mediaType,"_").concat(t?"send":"recv")){case"video_send":{const t=Ar(fr);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=Ar(Cr),r=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),r){const s=r.stats,i=Date.now()-r.lts;t.framesDecodeFreezeTime=s.framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Re({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=Ar(gr);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=Ar(Dr);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new Promise(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t.push(r)})),t}}let Mr=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),yr=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),Pr=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),vr=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var wr=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(wr||{});function Ur(e,t,r,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:wr.kNone;if(!t)return;const n=Number(t[r]);if("number"!=typeof n)return;const o=Number(t[s]);if("number"!=typeof o)return;if(!e)return o?n/o*i:void 0;const a=Number(e[r]);if("number"!=typeof a)return;const c=Number(e[s]);if("number"!=typeof c)return;const d=o-c;return d?(n-a)/d*i:void 0}class Fr extends Lr{constructor(){super(...arguments),pe(this,"_stats",Nr),pe(this,"report",void 0),pe(this,"lastDecodeVideoReceiverStats",new Map),pe(this,"lastVideoFramesRecv",new Map),pe(this,"lastVideoFramesSent",new Map),pe(this,"lastVideoFramesDecode",new Map),pe(this,"lastVideoFramesOutput",new Map),pe(this,"lastVideoJBDelay",new Map),pe(this,"lastAudioJBDelay",new Map),pe(this,"mediaBytesSent",new Map),pe(this,"mediaBytesRetransmit",new Map),pe(this,"mediaBytesTargetEncode",new Map),pe(this,"lastDecodeAudioReceiverStats",new Map),pe(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ar(Nr),this.report.forEach((e=>{switch(e.type){case vr.OUTBOUND:case vr.INBOUND:{const t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,s=!t&&!("frameWidth"in e);e.type===vr.OUTBOUND?"audio"===t||s?this.processAudioOutboundStats(e):("video"===t||r)&&this.processVideoOutboundStats(e):e.type===vr.INBOUND&&("audio"===t||s?this.processAudioInboundStats(e):("video"===t||r)&&this.processVideoInboundStats(e));break}case vr.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case vr.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:Re({},Or),remote:Re({},Or)};return e.forEach((r=>{let s;if(r.type===vr.TRANSPORT&&(s=e.get(r.selectedCandidatePairId)),r.type===vr.CANDIDATE_PAIR&&r.selected&&(s=r),s){const r=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(s.localCandidateId){const i=e.get(s.localCandidateId);i&&r(t.local,i)}if(s.remoteCandidateId){const i=e.get(s.remoteCandidateId);i&&r(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===vr.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===vr.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===vr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Re({},t),Re({},this.stats.selectedCandidatePair.localCandidate)),e.type===vr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Re({},t),Re({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=Ar(gr),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Ur(r,t,"totalProcessingDelay","jitterBufferEmittedCount",wr.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,Re({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=Ar(Cr),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const r=this.lastDecodeVideoReceiverStats.get(t.ssrc),s=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),n=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,r=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,r),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){const s=r.stats,i=n-r.lts;t.framesDecodeFreezeTime=s.framesDecodeFreezeTime,t.framesDecodeInterval=s.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>s.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<s.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Ur(null==r?void 0:r.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Ur(null==r?void 0:r.stats,t,"totalProcessingDelay","framesDecodeCount",wr.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Ur(null==r?void 0:r.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",wr.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Ur(null==r?void 0:r.stats,t,"totalInterFrameDelay","framesDecodeCount",wr.kMillisecondsFromSeconds),s&&n-s.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-s.count)/((n-s.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:n,rate:t.decodeFrameRate})):s?t.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:n,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&n-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((n-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:n,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:n,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Re({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=Ar(fr),this._stats.videoSend.push(t));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const t=new Sr(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new Sr(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new Sr(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-r.lastFrameCount,i=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*i/s}}if(e.framesEncoded&&e.qpSum){const r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,vr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=Ar(Dr),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const r=this.findRemoteStatsId(e.ssrc,vr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){const r=Array.from(this.report.values()).find((r=>r.type===t&&r.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){const r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var s,i,n,o;const a=t?this.report.get(t):void 0,c=null!==(s=null==a?void 0:a.framesSent)&&void 0!==s?s:e.framesSent;if("number"!=typeof c)return;let d=null!==(i=null==a?void 0:a.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(n=null==a?void 0:a.frameHeight)&&void 0!==n?n:e.frameHeight,E=null!==(o=null==a?void 0:a.framesPerSecond)&&void 0!==o?o:e.framesPerSecond;if("number"==typeof d&&"number"==typeof u||(d=0,u=0),null==E){const e=Date.now(),t=this.lastVideoFramesSent.get(r.ssrc);t&&e-t.lts>=800?(E=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:e,rate:E})):t?E=t.rate:this.lastVideoFramesSent.set(r.ssrc,{count:c,lts:e,rate:0})}r.sentFrame={width:d,height:u,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,r){var s,i,n,o,a;const c=t?this.report.get(t):void 0,d=null!==(s=null==c?void 0:c.framesReceived)&&void 0!==s?s:e.framesReceived,u=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,E=null!==(n=null==c?void 0:c.frameHeight)&&void 0!==n?n:e.frameHeight,_=null!==(o=null==c?void 0:c.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,h=null!==(a=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount;if("number"==typeof d){const e=this.lastVideoFramesRecv.get(r.ssrc),t=Date.now();r.framesReceivedCount=d;let s=0;e&&t-e.lts>=800?(s=Math.round((d-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:t,rate:s})):e?s=e.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:t,rate:0}),r.receivedFrame={width:u||0,height:E||0,frameRate:s||0},r.decodedFrame={width:u||0,height:E||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:u||0,height:E||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(_&&h){const e=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const s=h-e.jitterBufferEmittedCount;s>0&&(t=1e3*(_-e.jitterBufferDelay)/s),r.jitterBufferMs=t,r.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:h,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var s,i,n,o;const a=t?this.report.get(t):void 0,c=null!==(s=null!==(i=null==a?void 0:a.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==s?s:0,d=null!==(n=null!==(o=null==a?void 0:a.echoReturnLossEnhancement)&&void 0!==o?o:e.echoReturnLossEnhancement)&&void 0!==n?n:0;r.aecReturnLoss=c,r.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(e,t,r){var s,i,n,o,a,c,d;const u=t?this.report.get(t):void 0,E=null!==(s=null==u?void 0:u.removedSamplesForAcceleration)&&void 0!==s?s:e.removedSamplesForAcceleration,_=null!==(i=null==u?void 0:u.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,h=null!==(n=null==u?void 0:u.jitterBufferDelay)&&void 0!==n?n:e.jitterBufferDelay,l=null!==(o=null==u?void 0:u.jitterBufferEmittedCount)&&void 0!==o?o:e.jitterBufferEmittedCount,p=null!==(a=null==u?void 0:u.audioLevel)&&void 0!==a?a:null==e?void 0:e.audioLevel,T=null!==(c=null==u?void 0:u.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,R=null!==(d=null==u?void 0:u.concealedSamples)&&void 0!==d?d:e.concealedSamples;if("number"==typeof _&&(r.totalSamplesReceived=_),E&&_&&(r.accelerateRate=E/_),h&&l){const e=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const s=l-e.jitterBufferEmittedCount;s>0&&(t=1e3*(h-e.jitterBufferDelay)/s),r.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:l,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=p;let m=1920;T&&_&&(m=_/T/50,r.receivedFrames=Math.round(_/m)),R&&(r.droppedFrames=Math.round(R/m))}processRemoteInboundStats(e,t){const r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{r=null===r?e.diffMean():r+e.diffMean()}));const s=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==r&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class Vr extends Lr{updateStats(){return Promise.resolve()}}function kr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const n=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return n?n<76?new br(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:i}):new Fr(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof Promise||zt(t))}(e)?new Fr(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:i}):new Vr(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:s,firstVideoDecodedTimeout:i})}const Br="websdk_ng_install_id";function xr(){try{if($r("INSTALL_ID"))return $r("INSTALL_ID");let e=window.localStorage.getItem(Br);return e||(e=Vt(),window.localStorage.setItem(Br,e)),Zr("INSTALL_ID",e),e}catch(e){return}}const Gr=pr("4.23.2-1"),Kr=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}(),Wr=["CHINA","GLOBAL"];let Hr=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const Yr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");const s=r.join(""),i=[];for(let e=0;e<6;e++)i.push("1");const n=i.join(""),o={};return o[e]=s,o[t]=n,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Yr;const jr={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},Xr={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Jr={INSTALL_ID:""},zr="v4.23.2-1-0-g7fdaa39d-dirty(3/20/2025, 3:17:24 PM)",Qr={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},qr=Re(Re(Re({},Qr),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:Wr,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Xr,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},jr),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},Jr);function Zr(e,t,r){var s;Object.keys(qr).includes(e)&&(!r&&Object.keys(ts).includes(e)||(qr[e]=t,"ENABLE_VIDEO_SEI"!==e&&"ENABLE_AUDIO_TOPN"!==e&&"ENABLE_AUDIO_METADATA"!==e&&"ENABLE_AUDIO_PTS_METADATA"!==e||!0!==t||(qr.ENABLE_ENCODED_TRANSFORM=!0,"ENABLE_AUDIO_PTS_METADATA"===e&&(qr.ENABLE_AUDIO_METADATA=!0)),"USE_NEW_NETWORK_CONFIG"===e&&t&&(s=!!t,qr.USE_NEW_NETWORK_CONFIG=s,s&&(qr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],qr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],qr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],qr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],qr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",qr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",qr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(qr.ENABLE_INSTANT_VIDEO=!0,qr.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(qr.ENABLE_AUT_CC=!0),"NEW_FORCE_TURN"===e&&t&&(qr.NEW_TURN_MODE||(qr.NEW_TURN_MODE=4))))}function $r(e){return qr[e]}Kr||(qr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],qr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],qr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],qr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],qr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],qr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],qr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",qr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",qr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",qr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",qr.AREAS=["NORTH_AMERICA","OVERSEA"]);let es=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const ts={};var rs=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(rs||{});class ss{constructor(e,t,r,s){pe(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:r,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Hr.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case rs.SET_SESSION_ID:return Re(Re({},e),{},{sessionId:t.sessionId});case rs.SET_P2P_ID:return Re(Re({},e),{},{p2pId:t.p2pId});case rs.SET_UID:return Re(Re({},e),{},{uid:t.uid});case rs.SET_INT_UID:return Re(Re({},e),{},{intUid:t.intUid});case rs.SET_PUB_ID:return Re(Re({},e),{},{pubId:t.pubId});case rs.KEY_METRIC_CLIENT_CREATED:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{clientCreated:t.metric})});case rs.KEY_METRIC_JOIN_START:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{joinStart:t.metric})});case rs.AVOID_JOIN_START:return Re(Re({},e),{},{avoidJoinStart:t.avoidJoinStart});case rs.KEY_METRIC_JOIN_END:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{joinEnd:t.metric})});case rs.KEY_METRIC_REQUEST_AP_START:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{requestAPStart:t.metric})});case rs.KEY_METRIC_REQUEST_AP_END:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{requestAPEnd:t.metric})});case rs.KEY_METRIC_JOIN_GATEWAY_START:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case rs.KEY_METRIC_JOIN_GATEWAY_END:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case rs.KEY_METRIC_PEER_CONNECTION_START:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case rs.KEY_METRIC_PEER_CONNECTION_END:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case rs.KEY_METRIC_DESCRIPTION_START:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{descriptionStart:t.metric})});case rs.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case rs.KEY_METRIC_ICE_CONNECTION_END:return Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case rs.KEY_METRIC_PUBLISH:{const r=e.keyMetrics.publish,s=r.findIndex((e=>e.trackId===t.metric.trackId));return-1!==s?(r[s]=Re(Re({},r[s]),t.metric),Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{publish:[...r]})})):Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case rs.KEY_METRIC_SUBSCRIBE:{const r=e.keyMetrics.subscribe,s=r.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==s?(r[s]=Re(Re({},r[s]),t.metric),Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{subscribe:[...r]})})):Re(Re({},e),{},{keyMetrics:Re(Re({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case rs.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case rs.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=Re(Re({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case rs.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case rs.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case rs.SET_USE_P2P:return Re(Re({},e),{},{useP2P:t.val});case rs.SET_TRANSPORT_TYPE:return Re(Re({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:rs.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:rs.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:rs.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:rs.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:rs.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:rs.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:rs.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:rs.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:rs.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:rs.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:rs.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:rs.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:rs.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:rs.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:rs.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:rs.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:rs.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:rs.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:rs.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:rs.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:rs.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,r,s){this.dispatch({type:rs.KEY_METRIC_PUBLISH,metric:Re(Re({trackId:e,type:t},r&&{publishStart:r}),s&&{publishEnd:s})})}subscribe(e,t,r,s,i,n,o){this.dispatch({type:rs.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re(Re(Re({userId:e,type:t},r&&{subscribeStart:r}),s&&{subscribeEnd:s}),i&&{firstFrame:i}),n&&{streamAdded:n}),o&&{firstDecoded:o})})}massSubscribe(e,t,r,s){e.forEach((e=>{this.dispatch({type:rs.KEY_METRIC_SUBSCRIBE,metric:Re(Re(Re({userId:e.userId,type:e.type},t&&{subscribeStart:t}),r&&{subscribeEnd:r}),s&&{firstFrame:s})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:rs.RECORD_JOIN_CHANNEL_SERVICE,record:Re(Re({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:rs.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:rs.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:rs.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:rs.AVOID_JOIN_START,avoidJoinStart:e})}}let is=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({}),ns=function(e){return e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722",e}({});const os=128,as=96,cs=1e3,ds=10;let us=0;async function Es(e,t,r){const s=Array.from(r).reduce(((e,t)=>e+t),0),i={serverTs:0,seq:us++,length:r.length,checkSum:s},n=new Uint8Array(Yt(s,2)),o=new ArrayBuffer(ds),a=new DataView(o);a.setUint32(0,i.serverTs),a.setUint16(4,i.seq),a.setUint16(6,i.length),a.setUint16(8,i.checkSum);const c=16-r.length%16;r=Lt(r,new Uint8Array(c));const d=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:os,additionalData:n},t,r);return Lt(new Uint8Array(o),new Uint8Array(d))}async function _s(e,t,r){const s=r.subarray(0,ds),i=s.slice(8,ds),n=(i[0]<<8)+i[1],o=(s[6]<<8)+s[7],a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:os,additionalData:new Uint8Array(Yt(n,2))},t,r.subarray(ds));return r=new Uint8Array(a).subarray(0,o)}async function hs(e,t,r){const s=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,n=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:cs,hash:"SHA-256",salt:r},s,i+as);return new Uint8Array(n).subarray(i/8)}async function ls(e,t,r){const s=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:cs,hash:"SHA-256",salt:r},s,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var ps={exports:{}},Ts=ps.exports=(()=>{var e={8:(e,t,r)=>{r.r(t),r.d(t,{Parser:()=>O,Printer:()=>g,parse:()=>y,print:()=>P});const s="\n",i="".concat("\r").concat(s),n=" ";let o;function a(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function d(e){return c(e)||e>=""&&e<=""}function u(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function E(e){return e>="1"&&e<="9"}function _(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function h(e){return"d"===e||"h"===e||"m"===e||"s"===e}function l(e){return e>""&&e<"\t"||e>"\v"&&e<"\f"||e>""&&e<""}function p(e){return _(e)||a(e)||"+"===e||"/"===e}function T(e){return a(e)||_(e)||"+"===e||"/"===e||"-"===e||"_"===e}function R(e){return _(e)||a(e)||"+"===e||"/"===e}function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(o||(o={}));class S{consumeText(e,t){let r=t;for(;r<e.length;){const t=e[r];if("\0"===t||"\r"===t||t===s)break;r+=1}if(r-t==0)throw new Error("Invalid text, at ".concat(e));return r}consumeUnicastAddress(e,t,r){return this.consumeTill(e,t,n)}consumeOneOrMore(e,t,r){let s=t;for(;r(e[s]);)s++;if(s-t==0)throw new Error("Invalid rule at ".concat(t,"."));return s}consumeSpace(e,t){if(e[t]===n)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let r=t;for(let t=0;t<4;t++)if(r=this.consumeDecimalUChar(e,r),3!==t){if("."!==e[r])throw new Error("Invalid IP4 address.");r++}return r}consumeDecimalUChar(e,t){let r=t;for(let t=0;t<3&&a(e[r]);t++,r++);if(r-t==0)throw new Error("Invalid decimal uchar.");const s=parseInt(e.slice(t,r));if(s>=0&&s<=255)return r;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let r=this.consumeHexpart(e,t);return":"===e[r]?(r+=1,r=this.consumeIP4Address(e,r),r):r}consumeHexpart(e,t){let r=t;if(":"===e[r]&&":"===e[r+1]){r+=2;try{r=this.consumeHexseq(e,r)}catch(e){}return r}if(r=this.consumeHexseq(e,r),":"===e[r]&&":"===e[r+1]){r+=2;try{r=this.consumeHexseq(e,r)}catch(e){}return r}return r}consumeHexseq(e,t){let r=t;for(;r=this.consumeHex4(e,r),":"===e[r]&&":"!==e[r+1];)r+=1;return r}consumeHex4(e,t){let r=0;for(;r<4;r++)if(!((s=e[t+r])>="0"&&s<="9"||s>="a"&&s<="f"||s>="A"&&s<="F")){if(0===r)throw new Error("Invalid hex 4");break}var s;return t+r}consumeFQDN(e,t){let r=t;for(;a(e[r])||_(e[r])||"-"===e[r]||"."===e[r];)r+=1;if(r-t<4)throw new Error("Invalid FQDN");return r}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,d)}consumeMulticastAddress(e,t,r){switch(r){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(r){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const r=this.consumeHexpart(e,t);return"/"===e[r]?this.consumeInteger(e,r+1):r}consumeIP4MulticastAddress(e,t){let r=t+3;const s=e.slice(t,r),i=parseInt(s);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let t=0;t<3;t++){if("."!==e[r])throw new Error("Invalid IP4 multicast address.");r+=1,r=this.consumeDecimalUChar(e,r)}return"/"===e[r]&&(r+=1),r=this.consumeTTL(e,r),"/"===e[r]&&(r=this.consumeInteger(e,r)),r}consumeInteger(e,t){if(!E(e[t]))throw new Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!E(e[t]))throw new Error("Invalid TTL.");t+=1;for(let r=0;r<2&&a(e[t]);r++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,u)}consumeTime(e,t){let r=t;if("0"===e[r])return r+1;for(E(e[r])&&(r+=1);a(e[r]);)r++;if(r-t<10)throw new Error("Invalid time");return r}consumeAddress(e,t){return this.consumeTill(e,t,n)}consumeTypedTime(e,t){let r=t;return r=this.consumeOneOrMore(e,r,a),h(e[r])?r+1:r}consumeRepeatInterval(e,t){if(!E(e[t]))throw new Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return h(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,r){for(let s=0;s<r.length;s++){if(t+s>=e.length)throw new Error("consume exceeding value length");if(e[t+s]!==r[s])throw new Error("consume ".concat(r," failed at ").concat(s))}return t+r.length}consumeTill(e,t,r){let s=t;for(;s<e.length&&("string"!=typeof r||e[s]!==r)&&("function"!=typeof r||!r(e[s]));)s++;return s}}class O extends S{constructor(){super(),I(this,"records",[]),I(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!e.trim())).map(this.parseLine),this.currentLine=0;const r=this.parseVersion(),s=this.parseOrigin(),i=this.parseSessionName(),n=this.parseInformation(),o=this.parseUri(),a=this.parseEmail(),c=this.parsePhone(),d=this.parseConnection(),u=this.parseBandWidth(),E=this.parseTimeFields(),_=this.parseKey(),h=this.parseSessionAttribute(),l=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:r,origin:s,sessionName:i,information:n,uri:o,emails:a,phones:c,connection:d,bandwidths:u,timeFields:E,key:_,attributes:h,mediaDescriptions:l}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===s)return"\r"===e[t-1]?i:s;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const r=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:r,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new C;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==o.ATTRIBUTE)break;const r={attField:this.extractOneOrMore(t,(e=>u(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,r.attValue=this.extractOneOrMore(t,l)),e.parse(r),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new f(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==o.ATTRIBUTE)break;const r={attField:this.extractOneOrMore(e,(e=>u(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,r.attValue=this.extractOneOrMore(e,l)),t.parse(r),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===o.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===o.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const r=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let s=!1;"-"===e.value[e.cur]&&(s=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:r,typedTime:i,back:s})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==o.REPEAT)break;{const r=this.extract(t,this.consumeRepeatInterval),s=this.parseTypedTime(t);e.push({repeatInterval:r,typedTimes:s}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:r}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==o.BANDWIDTH)break;{const r=this.extractOneOrMore(t,u);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const s=this.extractOneOrMore(t,a);e.push({bwtype:r,bandwidth:s}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==o.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==o.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,d);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const s=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:r,sessVersion:s,nettype:i,addrtype:n,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===o.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==o.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===o.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==o.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==o.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===o.CONNECTION){const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const s=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:r,address:s}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let r=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,r+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const s=[];for(s.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,s.push(this.extract(e,this.consumeToken));if(0===s.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:r,protos:s,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===o.TIME;){const t=this.parseTime(),r=this.parseRepeat(),s=this.parseZone();e.push({time:t,repeats:r,zones:s})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===o.MEDIA;){const t=this.parseMedia(),r=this.parseInformation(),s=this.parseConnections(),i=this.parseBandWidth(),n=this.parseKey(),o=this.parseMediaAttributes(t);e.push({media:t,information:r,connections:s,bandwidths:i,key:n,attributes:o})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===o.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t,...r){const s=t.call(this,e.value,e.cur,...r),i=e.value.slice(e.cur,s);return e.cur=s,i}extractOneOrMore(e,t){const r=this.consumeOneOrMore(e.value,e.cur,t),s=e.value.slice(e.cur,r);return e.cur=r,s}consumeSpaceForRecord(e){if(e.value[e.cur]!==n)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class N extends S{constructor(...e){super(...e),I(this,"attributes",void 0),I(this,"digested",!1)}extractOneOrMore(e,t,r){const s=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,s),[n,o]=r||[];if("number"==typeof n&&i.length<n)throw new Error("error in length, should be more or equal than ".concat(n," characters."));if("number"==typeof o&&i.length>o)throw new Error("error in length, should be less or equal than ".concat(o," characters."));return e._cur=s,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==n)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t,...r){if(!e.attValue)throw new Error("Nothing to extract from attValue.");const s=t.call(this,e.attValue,e._cur,...r),i=e.attValue.slice(e._cur,s);return e._cur=s,i}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let r=0;r<t.length;r++)if(t[r]!==e.attValue[e._cur+r])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,p,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,p,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,p));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:r})}parseExtmap(e){const t=this.extractOneOrMore(e,a);let r;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),r=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeTill,n),i=A(A({entry:parseInt(t,10)},r&&{direction:r}),{},{extensionName:s});this.peekChar(e)===n&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class C extends N{constructor(...e){super(...e),I(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),r=[];for(;!this.atEnd(e)&&this.peekChar(e)===n;)this.consumeAttributeSpace(e),r.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:r})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,T)}parseIdentity(e){const t=this.extractOneOrMore(e,R),r=[];for(;!this.atEnd(e)&&this.peekChar(e)===n;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const s=this.extractOneOrMore(e,(e=>e!==n&&l(e)));r.push({name:t,value:s})}this.attributes.identities.push({assertionValue:t,extensions:r})}parseMsidSemantic(e){this.peekChar(e)===n&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const r=this.extract(e,this.consumeTill,n);t.identifierList.push(r)}}this.attributes.msidSemantic=t}}class f extends N{constructor(e){super(),I(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,p,[1,32]);this.consumeAttributeSpace(e);const r=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);const o=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const d=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const u={foundation:t,componentId:r,transport:s,priority:i,connectionAddress:o,port:d,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),u.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),u.relPort=this.extract(e,this.consumePort));this.peekChar(e)===n;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),u.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(u)}parseRemoteCandidate(e){const t=[];for(;;){const r=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:r,connectionAddress:s,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const s={encodingName:r,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),s.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=s:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:s,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,":");let s;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),s=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[r]=s:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[r]:s}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,n);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill),s={};r.split(";").forEach((e=>{let[t,r]=e.split("=");t=t.trim();const i="string"==typeof r?r.trim():null;"string"==typeof t&&t.length>0&&(s[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:s}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:s}})}parseFmtParameters(e){const t={},r=this.extract(e,this.consumeTill,"=");e._cur++;const s=this.extract(e,this.consumeTill,";");for(t[r]=s;";"===e.attValue[e._cur];){const r=this.extract(e,this.consumeTill,"=");e._cur++;const s=this.extract(e,this.consumeTill,";");t[r]=s}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,n),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,n);let s;if("trr-int"===r)s={type:r,interval:this.extract(e,this.consumeTill)};else{const t={type:r};this.peekChar(e)===n&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===n&&(t.additional=this.extract(e,this.consumeTill))),s=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(s);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(s):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[s]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===n&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,u),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,u),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,u,[1,64])};this.peekChar(e)===n&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,u,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>_(e)||a(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const r={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===n){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const r=this.extract(e,this.consumeToken);t.push(r);try{this.extract(e,this.consume,",")}catch(e){break}}r.payloads=t,this.peekChar(e)===n&&this.extract(e,this.consume,n)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const s={type:t,rids:this.extract(e,this.consume,"=").split(",")};r.params.push(s);break}default:{const s={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),s.val=this.extract(e,this.consumeTill,";")),r.params.push(s)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(r)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),r=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);r.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:r})}}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class g{constructor(){D(this,"eol",i)}print(e,t){let r="";return t&&(this.eol=t),r+=this.printVersion(e.version),r+=this.printOrigin(e.origin),r+=this.printSessionName(e.sessionName),r+=this.printInformation(e.information),r+=this.printUri(e.uri),r+=this.printEmail(e.emails),r+=this.printPhone(e.phones),r+=this.printConnection(e.connection),r+=this.printBandwidth(e.bandwidths),r+=this.printTimeFields(e.timeFields),r+=this.printKey(e.key),r+=this.printSessionAttributes(e.attributes),r+=this.printMediaDescription(e.mediaDescriptions),r}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const r of e)t+="e=".concat(r).concat(this.eol);return t}printPhone(e){let t="";for(const r of e)t+="e=".concat(r).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const r of e)t+="b=".concat(r.bwtype,":").concat(r.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const r of e){t+="t=".concat(r.time.startTime," ").concat(r.time.startTime).concat(this.eol);for(const e of r.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);r.zoneAdjustments&&(t+="z=",t+="z=".concat(r.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const r of e)t+="a=".concat(r.attField).concat(r.attValue?":".concat(r.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const r of e)t+=this.printMedia(r.media),t+=this.printInformation(r.information),t+=this.printConnections(r.connections),t+=this.printBandwidth(r.bandwidths),t+=this.printKey(r.key),t+=this.printMediaAttributes(r);return t}printConnections(e){let t="";for(const r of e)t+=this.printConnection(r);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new b(this.eol).print(e)}printMediaAttributes(e){return new M(this.eol).print(e)}}class L{constructor(e){D(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(n)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(n).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(n).concat(e.extensionName).concat(e.extensionAttributes?"".concat(n).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class b extends L{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(n).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(n).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(n,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(n).concat(e)))),t+this.eol}}class M extends L{print(e){const t=e.attributes;let r="";return r+=this.printRTCP(t.rtcp),r+=this.printIceUfrag(t.iceUfrag),r+=this.printIcePwd(t.icePwd),r+=this.printIceOptions(t.iceOptions),r+=this.printCandidates(t.candidates),r+=this.printRemoteCandidatesList(t.remoteCandidatesList),r+=this.printEndOfCandidates(t.endOfCandidates),r+=this.printFingerprints(t.fingerprints),r+=this.printSetup(t.setup),r+=this.printMid(t.mid),r+=this.printExtmap(t.extmaps),r+=this.printRTPRelated(t),r+=this.printPtime(t.ptime),r+=this.printMaxPtime(t.maxPtime),r+=this.printDirection(t.direction),r+=this.printSSRCGroups(t.ssrcGroups),r+=this.printSSRC(t.ssrcs),r+=this.printRTCPMux(t.rtcpMux),r+=this.printRTCPMuxOnly(t.rtcpMuxOnly),r+=this.printRTCPRsize(t.rtcpRsize),r+=this.printMSId(t.msids),r+=this.printImageattr(t.imageattr),r+=this.printRid(t.rids),r+=this.printSimulcast(t.simulcast),r+=this.printSCTPPort(t.sctpPort),r+=this.printMaxMessageSize(t.maxMessageSize),r+=this.printUnrecognized(t.unrecognized),r}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(n).concat(e.componentId).concat(n).concat(e.transport).concat(n).concat(e.priority).concat(n).concat(e.connectionAddress).concat(n).concat(e.port).concat(n,"typ").concat(n).concat(e.type).concat(e.relAddr?"".concat(n,"raddr").concat(n).concat(e.relAddr):"").concat(e.relPort?"".concat(n,"rport").concat(n).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(n).concat(t).concat(n).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(n)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let r="";r+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const e of t)r+=this.printRtpMap(e.payloadType,e.rtpMap),r+=this.printFmtp(e.payloadType,e.fmtp),r+=e.rtcpFeedbacks.map((t=>this.printRTCPFeedback(e.payloadType,t))).join("");return r}printFmtp(e,t){if(!t)return"";const r=Object.keys(t.parameters);return 1===r.length&&null===t.parameters[r[0]]?"a=fmtp:".concat(e).concat(n).concat(r[0]).concat(this.eol):"a=fmtp:".concat(e).concat(n).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(n).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let r="a=rtcp-fb:".concat(e).concat(n),s=t;return"trr-int"===s.type?r+="ttr-int".concat(n).concat(s.interval):(r+="".concat(s.type),s.parameter&&(r+="".concat(n).concat(s.parameter),s.additional&&(r+="".concat(n).concat(s.additional)))),r+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(n).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(n).concat(e.netType)),e.addressType&&(t+="".concat(n).concat(e.addressType)),e.address&&(t+="".concat(n).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(n).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(n).concat(e.direction);return e.payloads&&(t+="".concat(n,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(n).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(n).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function y(e){return(new O).parse(e)}function P(e,t){return(new g).print(e,t)}}},t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={exports:{}};return e[s](i,i.exports,r),i.exports}return r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8)})();function Rs(e){return Ts.parse(e)}function ms(e,t){return Ts.print(e,t)}export{Xe as AgoraAPIName,Je as AgoraAPITag,Ae as AgoraRTCError,me as AgoraRTCErrorCode,Lr as AgoraWebRTCStatsFilter,qe as AudienceLatencyLevelType,ns as AudioCodec,zr as BUILD,_ as BrowserName,E as BrowserOS,es as CONFIG_DISTRIBUTE_TYPE,ds as CRYPTO_HEADER_LENGTH,cs as CRYPTO_ITERATIONS,as as CRYPTO_IV_LENGTH,os as CRYPTO_TAG_LENGTH,nt as ClientEvents,Ze as ConnectionDisconnectedReason,Wr as DEFAULT_AREAS,gr as DEFAULT_AUDIO_RECV_STATS,Dr as DEFAULT_AUDIO_SEND_STATS,Or as DEFAULT_CANDIDATE_STATS,Nr as DEFAULT_PC_STATS,rr as DEFAULT_RETRY_CONFIG,Yr as DEFAULT_TURN_CONFIG,Cr as DEFAULT_VIDEO_RECV_STATS,fr as DEFAULT_VIDEO_SEND_STATS,Ke as EventEmitter,Jr as IMMUTABLE_PARAMS,Kr as IS_GLOBAL_VERSION,jr as MUTABLE_GATEWAY_PARAMS,qr as MUTABLE_PARAMS,ts as MUTABLE_PARAMS_LOCAL_CACHE,Qr as MUTABLE_REALTIME_PARAMS,ct as NETWORK_INDICATOR_EVENTS,at as NETWORK_STATE,Xr as OVERUSE_DETECTOR_PARAMS,Hr as P2PTransportType,Pr as PeerConnectionState,er as PromiseMutex,Mr as QualityLimitationReason,vr as RTCStatsType,or as Rolling,ss as SDKStore,Ge as SHA256,yr as ScalabilityMode,lr as TransformStreamAdapter,Gr as VERSION,is as VideoCodec,ot as WebSocketQuitReason,ke as appendBuffer,tr as atom,ft as base64ToUint8Array,Be as bufferToStr,ge as checkIsEqual,De as checkValidArray,Se as checkValidBoolean,Ce as checkValidConstrainLong,Oe as checkValidEnum,Ne as checkValidNumber,fe as checkValidString,At as compareArray,u as concurrent,jt as constrainLongToNumber,gt as convertStringToFixedLengthUint8Array,s as createDefer,Ie as createInternalUnexpectedError,i as createResolvedDefer,n as createTimeoutDefer,kr as createWebRTCStatsFilter,_s as decryptAesGcm,I as deprecatedGetBrowserInfo,Ct as detectSecureContext,yt as dividePackage,mr as domLoadedPromise,Fe as elementVisibleChecker,_t as emitAsInvoker,Et as emitAsInvokerNoResponse,dt as emitAsPromise,ut as emitAsPromiseNoResponse,Es as encryptAesGcm,xe as encryptRSA,It as findIndexs,hs as generateIv,ls as generateKey,Ft as generateProcessID,Vt as generateSessionID,Me as getBigInt64,ye as getBigUint64,T as getBrowserInfo,O as getBrowserOS,S as getBrowserVersion,St as getChangedKeysFromObject,de as getChromeKernelVersion,je as getElectronInstance,_r as getHTTPRecvBytes,Er as getHTTPSendBytes,Ve as getMessageEncoding,Mt as getMultiUnilbsFormDataByteLength,N as getOSWithVersion,$r as getParameter,Ut as getRandomString,sr as getRetryWaitTime,bt as getUTF8StringByteLength,pt as getUniqueList,qt as hexToBytes,U as isAboveChrome,k as isAboveEdge,B as isAboveFirefox,G as isAboveIOS,J as isAboveIOS13,ee as isAboveIOS15_1,te as isAboveIOS15_2,Z as isAboveIOS16_0,H as isAboveOpera,x as isAboveSafari,b as isAboveSafari15_4,_e as isAndroid,he as isAndroidChromium,F as isBelowChrome,K as isBelowIOS,z as isBelowIOS14_6,W as isBelowSafari,V as isBetweenBrowser,g as isChrome,Y as isChromeBelow90,ue as isChromeKernel,Qe as isClientConfig,rt as isClientRole,it as isClientRoleOptions,M as isEdge,We as isElectron,Le as isEmpty,tt as isEncryptionMode,y as isFirefox,Ee as isHarmonyOS,Tr as isHttpsEnv,w as isIOS,X as isIOS13,Q as isIOS15,$ as isIOS15_0,q as isIOS16,Ht as isInPage,re as isIpadOS,Xt as isJsonEqual,ie as isLegacyChrome,j as isMacOS,ce as isMobile,ae as isMobileAndTabletType,P as isOpera,st as isP2PTransport,le as isPageRecording,zt as isPromise,v as isQQBrowser,$e as isRTCIceServerList,ze as isRetryConfiguration,L as isSafari,ne as isSupportedPC,f as isSupportedWkWebview,et as isTurnServerConfig,be as isValidString,D as isWebKit,se as isWechatBrowser,oe as isWindows,C as isWkWebview,Rt as jsonClone,xr as loadInstallId,Qt as md5,ht as networkIndicator,Tt as nextTick,Bt as noop,Rs as parseSdp,dr as post,ur as postProtobuf,ms as printSdp,Wt as recursiveMerge,kt as releaseStream,lt as removeItemFromList,hr as resetHTTPBytesCount,ir as retryable,Nt as runOnce,mt as safeCloneJson,Pe as setBigInt64,ve as setBigUint64,Zr as setParameter,Yt as shiftAndPush,He as showElectronSelectSourceWindow,Rr as supportIsSecureContext,Gt as throttleByKey,Pt as timeout,Jt as toCamelCase,pr as transferVersion,R as transformBrowserName,m as transformBrowserVersion,A as transformOSName,Lt as uint8ArrayConcat,Dt as uint8ArrayToBase64,d as updateConcurrentNumber,wt as wait,vt as withTimeout};
